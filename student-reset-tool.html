<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Data Reset Tool - Bioestat Platform</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #856404;
        }
        
        .danger {
            background: #f8d7da;
            border: 2px solid #dc3545;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #721c24;
        }
        
        .success {
            background: #d4edda;
            border: 2px solid #28a745;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #155724;
        }
        
        .button {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }
        
        .button.danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }
        
        .button.danger:hover {
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }
        
        .button.warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);
        }
        
        .button.warning:hover {
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.4);
        }
        
        .instructions {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #3498db;
        }
        
        .code {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        .step {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #3498db;
            background: #f8f9fa;
        }
        
        .step h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        #output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
            white-space: pre-wrap;
        }
        
        .button-group {
            text-align: center;
            margin: 30px 0;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-healthy { background: #28a745; }
        .status-warning { background: #ffc107; }
        .status-critical { background: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Student Data Reset Tool</h1>
        <p class="subtitle">Ferramenta para reset de dados dos estudantes - Bioestat Platform</p>
        
        <div class="danger">
            <h3>‚ö†Ô∏è ATEN√á√ÉO CR√çTICA</h3>
            <p><strong>Esta ferramenta DELETA PERMANENTEMENTE todos os dados dos estudantes!</strong></p>
            <ul>
                <li>Contas de estudantes ser√£o removidas</li>
                <li>Todo progresso e pontua√ß√µes ser√£o perdidos</li>
                <li>Hist√≥rico de exerc√≠cios ser√° apagado</li>
                <li>Dados de professores e sistema ser√£o PRESERVADOS</li>
            </ul>
        </div>
        
        <div class="instructions">
            <h3>üìã Instru√ß√µes de Uso</h3>
            <div class="step">
                <h3>1. Verificar Status do Sistema</h3>
                <p>Primeiro, verifique a sa√∫de do sistema e quantos dados ser√£o afetados.</p>
                <button class="button" onclick="checkStatus()">üìä Verificar Status</button>
            </div>
            
            <div class="step">
                <h3>2. Executar Simula√ß√£o (Dry Run)</h3>
                <p>Execute uma simula√ß√£o segura para ver exatamente o que seria deletado.</p>
                <button class="button warning" onclick="executeDryRun()">üõ°Ô∏è Simular Reset</button>
            </div>
            
            <div class="step">
                <h3>3. Executar Reset Real (PERIGOSO!)</h3>
                <p>Apenas ap√≥s confirmar a simula√ß√£o, execute o reset real.</p>
                <button class="button danger" onclick="executeRealReset()">üö® Reset REAL</button>
            </div>
            
            <div class="step">
                <h3>4. Processo Completo Guiado</h3>
                <p>Execute toda a sequ√™ncia com confirma√ß√µes de seguran√ßa.</p>
                <button class="button" onclick="executeFullSequence()">üîÑ Processo Completo</button>
            </div>
        </div>
        
        <div class="warning">
            <h3>üîß Pr√©-requisitos</h3>
            <ul>
                <li>Estar logado como <strong>professor</strong> na plataforma</li>
                <li>Ter permiss√µes de administrador no Firebase</li>
                <li>Executar em ambiente de <strong>desenvolvimento/teste</strong> primeiro</li>
                <li>Criar backup manual se necess√°rio</li>
            </ul>
        </div>
        
        <div id="output">Aguardando comandos...\n\nPara come√ßar, clique em "Verificar Status" acima.</div>
        
        <div class="button-group">
            <button class="button" onclick="clearOutput()">üßπ Limpar Console</button>
            <button class="button" onclick="copyOutput()">üìã Copiar Log</button>
        </div>
        
        <div class="success">
            <h3>‚úÖ Comandos Manuais (Console do Navegador)</h3>
            <p>Voc√™ tamb√©m pode executar comandos diretamente no console:</p>
            <div class="code">
StudentResetCommands.status()      // Verificar status
StudentResetCommands.dryRun()      // Simular reset
StudentResetCommands.reset()       // Reset real
StudentResetCommands.fullSequence() // Processo completo
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    
    <script>
        // Configura√ß√£o do Firebase (mesma do projeto)
        const firebaseConfig = {
            apiKey: "AIzaSyBewwlrvwExkStQSyihgbb_OoI34oHFVZ0",
            authDomain: "vireiestatistica-ba7c5.firebaseapp.com",
            projectId: "vireiestatistica-ba7c5",
            storageBucket: "vireiestatistica-ba7c5.firebasestorage.app",
            messagingSenderId: "717809660419",
            appId: "1:717809660419:web:564836c9876cf33d2a9436"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        window.db = db;

        // Fun√ß√£o para log no output
        function logToOutput(message) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }

        // Sobrescrever console.log para capturar no output
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        const originalConsoleWarn = console.warn;

        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            logToOutput(args.join(' '));
        };

        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            logToOutput('‚ùå ERROR: ' + args.join(' '));
        };

        console.warn = function(...args) {
            originalConsoleWarn.apply(console, args);
            logToOutput('‚ö†Ô∏è WARNING: ' + args.join(' '));
        };

        // Fun√ß√µes da interface
        async function checkStatus() {
            logToOutput('Iniciando verifica√ß√£o de status...');
            try {
                const result = await StudentResetCommands.status();
                logToOutput('Status verificado com sucesso!');
                return result;
            } catch (error) {
                logToOutput('Erro ao verificar status: ' + error.message);
            }
        }

        async function executeDryRun() {
            logToOutput('Iniciando simula√ß√£o (dry run)...');
            try {
                const result = await StudentResetCommands.dryRun();
                logToOutput('Simula√ß√£o conclu√≠da com sucesso!');
                return result;
            } catch (error) {
                logToOutput('Erro na simula√ß√£o: ' + error.message);
            }
        }

        async function executeRealReset() {
            logToOutput('ATEN√á√ÉO: Iniciando reset REAL!');
            try {
                const result = await StudentResetCommands.reset();
                if (result) {
                    logToOutput('Reset real conclu√≠do!');
                } else {
                    logToOutput('Reset cancelado pelo usu√°rio.');
                }
                return result;
            } catch (error) {
                logToOutput('Erro no reset real: ' + error.message);
            }
        }

        async function executeFullSequence() {
            logToOutput('Iniciando processo completo guiado...');
            try {
                const result = await StudentResetCommands.fullSequence();
                logToOutput('Processo completo finalizado!');
                return result;
            } catch (error) {
                logToOutput('Erro no processo completo: ' + error.message);
            }
        }

        function clearOutput() {
            document.getElementById('output').textContent = 'Console limpo.\n\n';
        }

        function copyOutput() {
            const output = document.getElementById('output');
            navigator.clipboard.writeText(output.textContent).then(() => {
                alert('Log copiado para a √°rea de transfer√™ncia!');
            });
        }

        // Carregar o script principal
        logToOutput('Carregando Student Reset Script...');
    </script>
    
    <!-- Carregar o script principal -->
    <script src="browser-student-reset.js"></script>
</body>
</html>
